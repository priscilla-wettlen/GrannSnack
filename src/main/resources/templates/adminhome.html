<!DOCTYPE html>
<html lang="sv" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin</title>
</head>
<body>
<h1>Admin Homepage</h1><hr>
<p>Welcome to the Admin Home Page</p>

<button id="clickme">click</button>
<div id="user-container"></div>
<div id="user-item"></div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn =  document.getElementById("clickme");
        btn.addEventListener("click", getAllUsers)
    })

    function getAllUsers(){
        fetch("http://localhost:8080/a/home/users", {
            method: "GET"
        })
            .then(res => {
                if(!res.ok) throw new Error("Error: Användarlistan kunde inte hämtas.");
                // Fix the condition - this needs to be (res.status === 200 || res.status === 201)
                if(res.status === 200 || res.status === 201)
                    return res.json();
                else
                    throw new Error(`Unexpected status code: ${res.status}`);
            })
            .then(users => {
                const userContainer = document.getElementById("user-container");
                userContainer.innerHTML = "";

                let userContainerTitle = document.createElement("H3");
                userContainerTitle.innerText = "Registrerade användarna";
                userContainer.appendChild(userContainerTitle); // Add title only once, outside the loop


                users.forEach(user => {
                    const userItem = document.createElement("div");
                    userItem.className = "user-item";
                    userItem.textContent = `User: ${user.id} ${user.userName} ${user.userEmail} ${user.role}`;

                    const deleteUserBtn = document.createElement('button');
                    deleteUserBtn.textContent = 'Delete';
                    deleteUserBtn.addEventListener("click", function() {
                        deleteUser();
                    });

                    userItem.appendChild(deleteUserBtn);
                    userContainer.appendChild(userItem);
                });
            })
            .catch(error => {
                console.error("Failed to fetch users:", error);
                const userContainer = document.getElementById("user-container");
                userContainer.innerHTML = `<p>Error loading users: ${error.message}</p>`;
            });
    }

    function deleteUser(){
        fetch()
    }
</script>
</body>
</html>